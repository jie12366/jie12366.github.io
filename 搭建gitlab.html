<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="keywords" content="web,java,大数据,"><title>在基于ubuntu16的云服务器搭建gitlab服务。 | Monkey_jie</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style-dark.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/css/highlight-dark.css?v=2.0.3"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">在基于ubuntu16的云服务器搭建gitlab服务。</h1><a id="logo" href="/.">Monkey_jie</a><p class="description">活在当下，别在怀念过去或者憧憬未来中浪费掉你现在的生活</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/photos/"><i class="fa undefined"> 相册</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">在基于ubuntu16的云服务器搭建gitlab服务。</h1><div class="post-meta"><a href="/搭建gitlab.html#comments" class="comment-count"></a><p><span class="date">Mar 09, 2019</span><span><a href="/categories/服务搭建/" class="category">服务搭建</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h4 id="一、安装："><a href="#一、安装：" class="headerlink" title="一、安装："></a>一、安装：</h4><h6 id="1、安装依赖包，输入以下命令："><a href="#1、安装依赖包，输入以下命令：" class="headerlink" title="1、安装依赖包，输入以下命令："></a>1、安装依赖包，输入以下命令：</h6><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install curl openssh-server ca-certificates <span class="built_in">postfix</span></span><br></pre></td></tr></table></figure>
<p>执行完后，邮件配置的时候，选择 Internet site，其他的ok就行。</p>
<h6 id="2、用清华大学的镜像安装主程序（国外的太慢了，可能要几个小时）"><a href="#2、用清华大学的镜像安装主程序（国外的太慢了，可能要几个小时）" class="headerlink" title="2、用清华大学的镜像安装主程序（国外的太慢了，可能要几个小时）"></a>2、用清华大学的镜像安装主程序（国外的太慢了，可能要几个小时）</h6><h6 id="注意-gitlab-ce-镜像仅支持-x86-64-架构（Debian-Ubuntu-用户）"><a href="#注意-gitlab-ce-镜像仅支持-x86-64-架构（Debian-Ubuntu-用户）" class="headerlink" title="注意: gitlab-ce 镜像仅支持 x86-64 架构（Debian/Ubuntu 用户）"></a>注意: gitlab-ce 镜像仅支持 x86-64 架构（Debian/Ubuntu 用户）</h6><p>1) 首先信任 GitLab 的 GPG 公钥:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https:<span class="regexp">//</span>packages.gitlab.com<span class="regexp">/gpg.key 2&gt; /</span>dev<span class="regexp">/null | sudo apt-key add - &amp;&gt;/</span>dev<span class="regexp">/null</span></span><br></pre></td></tr></table></figure>
<p>2) 进入root管理员用户，输入以下命令：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vim</span> /etc/apt/sources.<span class="keyword">list</span>.d/gitlab-<span class="keyword">ce</span>.<span class="keyword">list</span></span><br></pre></td></tr></table></figure>
<p>在打开的文件中加入以下内容：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">deb</span> http<span class="variable">s:</span>//mirrors.tuna.tsinghua.edu.<span class="keyword">cn</span>/gitlab-<span class="keyword">ce</span>/ubuntu xenial main</span><br></pre></td></tr></table></figure>
<p>3) 安装 gitlab-ce:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> update</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install gitlab-ce</span><br></pre></td></tr></table></figure>
<h5 id="二、配置和运行"><a href="#二、配置和运行" class="headerlink" title="二、配置和运行"></a>二、配置和运行</h5><p>1、配置GitLab IP地址，首先运行：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -e <span class="regexp">/etc/gi</span>tlab<span class="regexp">/gitlab.rb</span></span><br></pre></td></tr></table></figure>
<p>在文本中修改”externval_url”之后的域名，指向服务器ip或者ip指向的域名（注意要带有“https://”），这一行在全部文本中位于很靠上面的位置。</p>
<p>2、更新配置并运行：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo gitlab-ctl reconfigure</span></span><br></pre></td></tr></table></figure>
<p>3.打开 sshd 和 postfix 服务：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service sshd start</span><br><span class="line">service postfix start</span><br></pre></td></tr></table></figure>
<p>4、为了使 GitLab 社区版的 Web 界面可以通过网络进行访问，我们需要允许 80 端口通过防火墙，这个端口是 GitLab 社区版的默认端口。为此需要运行下面的命令：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -A INPUT -<span class="selector-tag">p</span> tcp -m tcp --dport <span class="number">80</span> -j ACCEPT</span><br></pre></td></tr></table></figure></p>
<p>5、检查GitLab是否安装好并且已经正确运行，输入下面的命令：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo gitlab-ctl status</span></span><br></pre></td></tr></table></figure>
<p>如果显示都在run，则表示正确运行。</p>
<p>到此，你的gitlab服务以及搭建好了，打开浏览器，输入你的服务器ip地址，就可以访问到gitlab的登录界面啦。</p>
<p>然后，会有一个问题，就是gitlab的访问速度会非常慢，简直龟速啊，还容易出现502。。原因是gitlab占用内存太多，导致服务器崩溃。</p>
<h5 id="三、Swap分区"><a href="#三、Swap分区" class="headerlink" title="三、Swap分区"></a>三、Swap分区</h5><p>Swap分区在系统的物理内存不够用的时候，把物理内存中的一部分空间释放出来，以供当前运行的程序使用。那些被释放的空间可能来自一些很长时间没有什么操作的程序，这些被释放的空间被临时保存到Swap分区中，等到那些程序要运行时，再从Swap分区中恢复保存的数据到内存中。</p>
<p>云服务器默认swap分区是没启动的，输入free查看,如下显示的都是0<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@yoyo sbin]<span class="comment"># free</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:       <span class="number"> 3881692 </span>   <span class="number"> 3219200 </span>    <span class="number"> 369316 </span>     <span class="number"> 52184 </span>    <span class="number"> 293176 </span>     360244</span><br><span class="line">Swap:            <span class="number"> 0 </span>         <span class="number"> 0 </span>          0</span><br></pre></td></tr></table></figure></p>
<p>创建swap大小为bs*count=4294971392(4G)</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/mnt/swap <span class="attribute">bs</span>=512 <span class="attribute">count</span>=8388616</span><br></pre></td></tr></table></figure>
<p>通过mkswap命令将上面新建出的文件做成swap分区</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkswap /mnt/<span class="keyword">swap</span></span><br></pre></td></tr></table></figure>
<p>vim编辑/etc/sysctl.conf，加入以下内容：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vm<span class="selector-class">.swappiness</span> = <span class="number">60</span></span><br><span class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.neigh</span><span class="selector-class">.default</span><span class="selector-class">.gc_stale_time</span>=<span class="number">120</span></span><br></pre></td></tr></table></figure>
<p>启用分区：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">swapon /mnt/<span class="keyword">swap</span></span><br><span class="line">echo “/data/<span class="keyword">swap</span> <span class="keyword">swap</span> <span class="keyword">swap</span> defaults <span class="number">0</span> <span class="number">0</span>” &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>
<p>再次输入free查看：</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@instance-v7jtqjmo:~<span class="comment"># free</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:       <span class="number"> 2048060 </span>   <span class="number"> 1693380 </span>     <span class="number"> 68764 </span>     <span class="number"> 29220 </span>    <span class="number"> 285916 </span>     154608</span><br><span class="line">Swap:      <span class="number"> 4194304 </span>    <span class="number"> 721644 </span>    3472660</span><br></pre></td></tr></table></figure>
<p>可以看到swap分区已经启动了，再次打开你的gitlab页面，发现速度已经是飞快的了，一兆带宽也能飞，速度远超github。</p>
</div><div class="post-copyright"><blockquote><p>原文作者: jie</p><p>原文链接: <a href="http://www.xyj123.xyz/搭建gitlab.html">http://www.xyj123.xyz/搭建gitlab.html</a></p><p>版权声明: 转载请注明出处(必须保留原文链接http://www.xyj123.xyz)</p></blockquote></div><div class="tags"><a href="/tags/gitlab/">gitlab</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/oj四题.html" class="pre">记录菜鸡第一次用杭电oj</a><a href="/mybatis的ACtable插件.html" class="next">springboot+mybatis实现自动创建或者更新表</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC80Mjk1NC8xOTUwMA=="></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#一、安装："><span class="toc-text">一、安装：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1、安装依赖包，输入以下命令："><span class="toc-text">1、安装依赖包，输入以下命令：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2、用清华大学的镜像安装主程序（国外的太慢了，可能要几个小时）"><span class="toc-text">2、用清华大学的镜像安装主程序（国外的太慢了，可能要几个小时）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#注意-gitlab-ce-镜像仅支持-x86-64-架构（Debian-Ubuntu-用户）"><span class="toc-text">注意: gitlab-ce 镜像仅支持 x86-64 架构（Debian/Ubuntu 用户）</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#二、配置和运行"><span class="toc-text">二、配置和运行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#三、Swap分区"><span class="toc-text">三、Swap分区</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/oj四题.html">记录菜鸡第一次用杭电oj</a></li><li class="post-list-item"><a class="post-list-link" href="/搭建gitlab.html">在基于ubuntu16的云服务器搭建gitlab服务。</a></li><li class="post-list-item"><a class="post-list-link" href="/mybatis的ACtable插件.html">springboot+mybatis实现自动创建或者更新表</a></li><li class="post-list-item"><a class="post-list-link" href="/项目推到github.html">如何将自己的本地项目推到github（详细版）</a></li><li class="post-list-item"><a class="post-list-link" href="/mybati的pagehelper分页插件详解.html">mybatis的pagehelper分页插件详解</a></li><li class="post-list-item"><a class="post-list-link" href="/mysql5.6转mysql8遇到的坑.html">msyql5.6转mysql8遇到的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/hexo可视化编辑.html">hexo可视化编辑问题的解决</a></li><li class="post-list-item"><a class="post-list-link" href="/解决端口冲突问题.html">通过cmd查找端口对应程序解决端口冲突</a></li><li class="post-list-item"><a class="post-list-link" href="/hexo+github搭建博客.html">hexo+github搭建属于自己的博客</a></li><li class="post-list-item"><a class="post-list-link" href="/springboot+mybatis最新版注解配置实现CURD.html">springboot+mybatis最新版注解配置实现CURD</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mybatis/">mybatis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web前端/">web前端</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web后端/">web后端</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/博客搭建/">博客搭建</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务搭建/">服务搭建</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/积累经验/">积累经验</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/ACtable/" style="font-size: 15px;">ACtable</a> <a href="/tags/mybatis/" style="font-size: 15px;">mybatis</a> <a href="/tags/mysql8/" style="font-size: 15px;">mysql8</a> <a href="/tags/springboot/" style="font-size: 15px;">springboot</a> <a href="/tags/初解四题/" style="font-size: 15px;">初解四题</a> <a href="/tags/响应式布局/" style="font-size: 15px;">响应式布局</a> <a href="/tags/gitlab/" style="font-size: 15px;">gitlab</a> <a href="/tags/端口冲突/" style="font-size: 15px;">端口冲突</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://blog.csdn.net/qq_40663357" title="Monkey_jie" target="_blank">Monkey_jie</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">jie.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.3"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script>(function(d, s) {
  var j, e = d.getElementsByTagName('body')[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.appendChild(j);
})(document, 'script');
</script></body></html>