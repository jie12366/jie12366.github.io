<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="keywords" content="web,java,大数据,"><title>java爬取歌曲并存入数据库 | Monkey_jie</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style-dark.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/css/highlight-dark.css?v=2.0.3"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">java爬取歌曲并存入数据库</h1><a id="logo" href="/.">Monkey_jie</a><p class="description">活在当下，别在怀念过去或者憧憬未来中浪费掉你现在的生活</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/photos/"><i class="fa undefined"> 相册</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">java爬取歌曲并存入数据库</h1><div class="post-meta"><a href="/java爬取歌曲并存入数据库.html#comments" class="comment-count"></a><p><span class="date">Apr 27, 2019</span><span><a href="/categories/java爬虫/" class="category">java爬虫</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>这里只解析一下代码，所需工具jsoup、HttpClient<br>httpCLient获取html后，用jsoup解析html，再用java来获取所需要的信息。<br><strong>之前写的有点问题，今天改了一下。因为通过hash值拼接的地址是个临时地址，存在数据库后一天就失效了，所以我改了一下。先把爬到的歌曲下载到本地，然后上传到七牛云的对象存储空间，再返回这个地址。最后把七牛云上的地址存到数据库中，这样就是永久的了。</strong></p>
<p>HTTPManage：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.after.demo.spider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.Jsoup;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Document;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.select.Elements;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author www.xyjz123.xyz</span></span><br><span class="line"><span class="comment"> * @description</span></span><br><span class="line"><span class="comment"> * @date 2019/4/19 19:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlManage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">Document</span> manage(<span class="type">String</span> html)&#123;</span><br><span class="line">        <span class="type">Document</span> doc = <span class="type">Jsoup</span>.parse(html);</span><br><span class="line">        <span class="keyword">return</span> doc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HttpGetConnect：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.after.demo.spider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.conn.BasicHttpClientConnectionManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.<span class="keyword">BufferedReader</span>;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author www.xyjz123.xyz</span></span><br><span class="line"><span class="comment"> * @description</span></span><br><span class="line"><span class="comment"> * @date 2019/4/19 19:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> class HttpGetConnect &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  获取html内容</span></span><br><span class="line"><span class="comment">     * @param url</span></span><br><span class="line"><span class="comment">     * @param charsetName  UTF-8、GB2312</span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     * @throws IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> connect(<span class="keyword">String</span> url,<span class="keyword">String</span> charsetName) <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        BasicHttpClientConnectionManager connManager = <span class="keyword">new</span> BasicHttpClientConnectionManager();</span><br><span class="line"></span><br><span class="line">        CloseableHttpClient httpclient = HttpClients.custom()</span><br><span class="line">                .setConnectionManager(connManager)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">String</span> content = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            HttpGet httpget = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line"></span><br><span class="line">            RequestConfig requestConfig = RequestConfig.custom()</span><br><span class="line">                    .setSocketTimeout(<span class="number">5000</span>)</span><br><span class="line">                    .setConnectTimeout(<span class="number">50000</span>)</span><br><span class="line">                    .setConnectionRequestTimeout(<span class="number">50000</span>)</span><br><span class="line">                    .build();</span><br><span class="line">            httpget.setConfig(requestConfig);</span><br><span class="line">            httpget.setHeader(<span class="string">"Accept"</span>, <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span>);</span><br><span class="line">            httpget.setHeader(<span class="string">"Accept-Encoding"</span>, <span class="string">"gzip,deflate,sdch"</span>);</span><br><span class="line">            httpget.setHeader(<span class="string">"Accept-Language"</span>, <span class="string">"zh-CN,zh;q=0.8"</span>);</span><br><span class="line">            httpget.setHeader(<span class="string">"Connection"</span>, <span class="string">"keep-alive"</span>);</span><br><span class="line">            httpget.setHeader(<span class="string">"Upgrade-Insecure-Requests"</span>, <span class="string">"1"</span>);</span><br><span class="line">            httpget.setHeader(<span class="string">"User-Agent"</span>, <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.101 Safari/537.36"</span>);</span><br><span class="line">            httpget.setHeader(<span class="string">"cache-control"</span>, <span class="string">"max-age=0"</span>);</span><br><span class="line"></span><br><span class="line">            CloseableHttpResponse response = httpclient.execute(httpget);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">int</span> status = response.getStatusLine().getStatusCode();</span><br><span class="line">            <span class="keyword">if</span> (status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span>) &#123;</span><br><span class="line"></span><br><span class="line">                HttpEntity entity = response.getEntity();</span><br><span class="line">                InputStream instream = entity.getContent();</span><br><span class="line">                <span class="keyword">BufferedReader</span> br = <span class="keyword">new</span> <span class="keyword">BufferedReader</span>(<span class="keyword">new</span> InputStreamReader(instream,charsetName));</span><br><span class="line">                StringBuffer sbf = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">                <span class="keyword">String</span> <span class="built_in">line</span> = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">while</span> ((<span class="built_in">line</span> = br.readLine()) != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    sbf.<span class="built_in">append</span>(<span class="built_in">line</span> + <span class="string">"\n"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                br.close();</span><br><span class="line">                content = sbf.toString();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                content = <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            httpclient.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//log.info("content is " + content);</span></span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Log <span class="built_in">log</span> = LogFactory.getLog(HttpGetConnect.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MusicController：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.after.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.after.demo.entity.Music;</span><br><span class="line"><span class="keyword">import</span> com.after.demo.service.impl.MusicServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.after.demo.service.impl.UploadServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.after.demo.spider.FileDownload;</span><br><span class="line"><span class="keyword">import</span> com.after.demo.spider.HtmlManage;</span><br><span class="line"><span class="keyword">import</span> com.after.demo.spider.HttpGetConnect;</span><br><span class="line"><span class="keyword">import</span> com.after.demo.utils.GetString;</span><br><span class="line"><span class="keyword">import</span> com.after.demo.utils.JsonResult;</span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.QiniuException;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.http.Response;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.model.DefaultPutRet;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> net.sf.json.<span class="keyword">JSONObject</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Document;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Element;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.select.Elements;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author www.xyjz123.xyz</span></span><br><span class="line"><span class="comment"> * @description</span></span><br><span class="line"><span class="comment"> * @date 2019/4/19 21:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@RestController</span><br><span class="line"><span class="keyword">public</span> class MusicController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    MusicServiceImpl musicService;</span><br><span class="line">    @Autowired</span><br><span class="line">    UploadServiceImpl uploadService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> FILEPATH = <span class="string">"F:/music/"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> mp3 = <span class="string">"https://wwwapi.kugou.com/yy/index.php?r=play/getdata&amp;callback=jQuery191027067069941080546_1546235744250&amp;"</span></span><br><span class="line">            + <span class="string">"hash=HASH&amp;album_id=0&amp;_=TIME"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> LINK = <span class="string">"https://www.kugou.com/yy/rank/home/PAGE-33164.html?from=rank"</span>;</span><br><span class="line"></span><br><span class="line">    @GetMapping(<span class="string">"/music/save"</span>)</span><br><span class="line">    @ApiOperation(<span class="string">"将酷狗歌单爬取存入数据库"</span>)</span><br><span class="line">    <span class="keyword">public</span> JsonResult saveMusic() <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span> ; i &lt; <span class="number">10</span> ; i++)&#123;</span><br><span class="line">            <span class="keyword">String</span> url = LINK.replace(<span class="string">"PAGE"</span>, i + <span class="string">""</span>);</span><br><span class="line">            getTitle(url);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PostMapping(<span class="string">"/music/getOne"</span>)</span><br><span class="line">    @ApiOperation(<span class="string">"随机获取一首歌"</span>)</span><br><span class="line">    <span class="keyword">public</span> JsonResult getMusic()&#123;</span><br><span class="line">        <span class="built_in">int</span> id = GetString.getId();</span><br><span class="line">        Music music = musicService.getMusicById(id);</span><br><span class="line">        <span class="keyword">return</span> JsonResult.ok(music);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> getTitle(<span class="keyword">String</span> url) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">String</span> content = HttpGetConnect.connect(url, <span class="string">"utf-8"</span>);</span><br><span class="line">        HtmlManage html = <span class="keyword">new</span> HtmlManage();</span><br><span class="line">        Document doc = html.manage(content);</span><br><span class="line">        Element ele = doc.getElementsByClass(<span class="string">"pc_temp_songlist"</span>).<span class="built_in">get</span>(<span class="number">0</span>);</span><br><span class="line">        Elements eles = ele.getElementsByTag(<span class="string">"li"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">0</span> ; i &lt; eles.<span class="built_in">size</span>() ; i++)&#123;</span><br><span class="line">            Element item = eles.<span class="built_in">get</span>(i);</span><br><span class="line">            <span class="keyword">String</span> title = item.attr(<span class="string">"title"</span>).<span class="built_in">trim</span>();</span><br><span class="line">            <span class="keyword">String</span> link = item.getElementsByTag(<span class="string">"a"</span>).first().attr(<span class="string">"href"</span>);</span><br><span class="line">            download(link,title);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> download(<span class="keyword">String</span> url,<span class="keyword">String</span> name) <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="keyword">String</span> hash = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">String</span> content = HttpGetConnect.connect(url, <span class="string">"utf-8"</span>);</span><br><span class="line">        HtmlManage html = <span class="keyword">new</span> HtmlManage();</span><br><span class="line">        <span class="keyword">String</span> regEx = <span class="string">"\"hash\":\"[0-9A-Z]+\""</span>;</span><br><span class="line">        <span class="comment">// 编译正则表达式</span></span><br><span class="line">        Pattern pattern = Pattern.compile(regEx);</span><br><span class="line">        Matcher matcher = pattern.matcher(content);</span><br><span class="line">        <span class="keyword">if</span> (matcher.find()) &#123;</span><br><span class="line">            hash = matcher.group();</span><br><span class="line">            hash = hash.replace(<span class="string">"\"hash\":\""</span>, <span class="string">""</span>);</span><br><span class="line">            hash = hash.replace(<span class="string">"\""</span>, <span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//爬取歌曲的封面图</span></span><br><span class="line">        Document doc = html.manage(content);</span><br><span class="line">        Element ele = doc.getElementsByClass(<span class="string">"albumImg"</span>).<span class="built_in">get</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">String</span> imgUrl = ele.getElementsByTag(<span class="string">"img"</span>).attr(<span class="string">"src"</span>);</span><br><span class="line">        <span class="comment">//利用hash值构造歌曲mp3地址</span></span><br><span class="line">        <span class="keyword">String</span> item = mp3.replace(<span class="string">"HASH"</span>, hash);</span><br><span class="line">        item = item.replace(<span class="string">"TIME"</span>, System.currentTimeMillis() + <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">String</span> mp = HttpGetConnect.connect(item, <span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        mp = mp.substring(mp.indexOf(<span class="string">"("</span>) + <span class="number">1</span>, mp.length() - <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">JSONObject</span> json = <span class="keyword">JSONObject</span>.fromObject(mp);</span><br><span class="line">        <span class="keyword">String</span> playUrl = json.getJSONObject(<span class="string">"data"</span>).getString(<span class="string">"play_url"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(playUrl);</span><br><span class="line">        FileDownload fileDownload = <span class="keyword">new</span> FileDownload();</span><br><span class="line">        fileDownload.download(playUrl,FILEPATH + name + <span class="string">".mp3"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">String</span> src = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            File file = <span class="keyword">new</span> File(FILEPATH + name + <span class="string">".mp3"</span>);</span><br><span class="line">            Response response = uploadService.uploadFile(file);</span><br><span class="line">            <span class="comment">//解析上传成功的结果</span></span><br><span class="line">            DefaultPutRet  putRet = <span class="keyword">new</span> Gson().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">            src = <span class="string">"http://www.jie12366.xyz/"</span> + putRet.<span class="built_in">key</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (QiniuException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果图片地址或mp3地址为空，则不爬取（歌曲是收费的无法爬取）</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(src) &amp;&amp; StringUtils.isNotBlank(imgUrl))&#123;</span><br><span class="line">            musicService.saveMusic(name,imgUrl,src);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> playUrl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新增FileDownload类：</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.after.demo.spider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author www.xyjz123.xyz</span></span><br><span class="line"><span class="comment"> * @description</span></span><br><span class="line"><span class="comment"> * @date 2019/4/24 16:37</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileDownload</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件下载</span></span><br><span class="line"><span class="comment">     * @param url 链接地址</span></span><br><span class="line"><span class="comment">     * @param path 要保存的路径及文件名</span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> void download(<span class="keyword">String</span> url,<span class="keyword">String</span> path)&#123;</span><br><span class="line">        CloseableHttpClient httpclient = HttpClients.createDefault();</span><br><span class="line">        RequestConfig requestConfig = RequestConfig.custom().setSocketTimeout(<span class="number">2000</span>)</span><br><span class="line">                .setConnectTimeout(<span class="number">2000</span>).build();</span><br><span class="line"></span><br><span class="line">        HttpGet <span class="keyword">get</span> = <span class="keyword">new</span> <span class="type">HttpGet</span>(url);</span><br><span class="line">        <span class="keyword">get</span>.setConfig(requestConfig);</span><br><span class="line"></span><br><span class="line">        BufferedInputStream <span class="keyword">in</span> = <span class="literal">null</span>;</span><br><span class="line">        BufferedOutputStream out = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(int i=<span class="number">0</span>;i &lt; <span class="number">3</span>;i++)&#123;</span><br><span class="line">                CloseableHttpResponse result = httpclient.execute(<span class="keyword">get</span>);</span><br><span class="line">                <span class="keyword">if</span>(result.getStatusLine().getStatusCode() == <span class="number">200</span>)&#123;</span><br><span class="line">                    <span class="keyword">in</span> = <span class="keyword">new</span> <span class="type">BufferedInputStream</span>(result.getEntity().getContent());</span><br><span class="line">                    File file = <span class="keyword">new</span> <span class="type">File</span>(path);</span><br><span class="line">                    out = <span class="keyword">new</span> <span class="type">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="type">FileOutputStream</span>(file));</span><br><span class="line">                    byte[] buffer = <span class="keyword">new</span> <span class="type">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                    int len = <span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">while</span>((len = <span class="keyword">in</span>.read(buffer,<span class="number">0</span>,<span class="number">1024</span>)) &gt; <span class="number">-1</span>)&#123;</span><br><span class="line">                        out.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(result.getStatusLine().getStatusCode() == <span class="number">500</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;finally&#123;</span><br><span class="line">            <span class="keyword">get</span>.releaseConnection();</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">in</span> != <span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">in</span>.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(out != <span class="literal">null</span>)&#123;</span><br><span class="line">                    out.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>entiry:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">package</span> <span class="selector-tag">com</span><span class="selector-class">.after</span><span class="selector-class">.demo</span><span class="selector-class">.entity</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">com</span><span class="selector-class">.gitee</span><span class="selector-class">.sunchenbin</span><span class="selector-class">.mybatis</span><span class="selector-class">.actable</span><span class="selector-class">.annotation</span><span class="selector-class">.Column</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">com</span><span class="selector-class">.gitee</span><span class="selector-class">.sunchenbin</span><span class="selector-class">.mybatis</span><span class="selector-class">.actable</span><span class="selector-class">.annotation</span><span class="selector-class">.Table</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">com</span><span class="selector-class">.gitee</span><span class="selector-class">.sunchenbin</span><span class="selector-class">.mybatis</span><span class="selector-class">.actable</span><span class="selector-class">.constants</span><span class="selector-class">.MySqlTypeConstant</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">lombok</span><span class="selector-class">.AllArgsConstructor</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">lombok</span><span class="selector-class">.Data</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">lombok</span><span class="selector-class">.NoArgsConstructor</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author www.xyjz123.xyz</span></span><br><span class="line"><span class="comment"> * @description</span></span><br><span class="line"><span class="comment"> * @date 2019/4/19 19:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@<span class="keyword">Data</span></span><br><span class="line">@<span class="keyword">AllArgsConstructor</span></span><br><span class="line">@<span class="keyword">NoArgsConstructor</span></span><br><span class="line">@<span class="keyword">Table</span>(<span class="keyword">name</span> = <span class="string">"music"</span>)</span><br><span class="line">public class Music &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="keyword">Column</span>(<span class="keyword">name</span> = <span class="string">"id"</span>,type = MySqlTypeConstant.INT,isKey = true,isAutoIncrement = true,length = <span class="number">5</span>)</span><br><span class="line">    private int id;</span><br><span class="line"></span><br><span class="line">    @<span class="keyword">Column</span>(<span class="keyword">name</span> = <span class="string">"name"</span>,type = MySqlTypeConstant.VARCHAR,isUnique = true)</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    @<span class="keyword">Column</span>(<span class="keyword">name</span> = <span class="string">"imgUrl"</span>,type = MySqlTypeConstant.VARCHAR,length = <span class="number">80</span>)</span><br><span class="line">    private String imgUrl;</span><br><span class="line"></span><br><span class="line">    @<span class="keyword">Column</span>(<span class="keyword">name</span> = <span class="string">"src"</span>,type = MySqlTypeConstant.VARCHAR)</span><br><span class="line">    private String src;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mapper:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.after.demo.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.after.demo.entity.Music;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> www.xyjz123.xyz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/4/19 21:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MusicMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将爬取的歌曲信息存入数据库</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 歌曲名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imgUrl 歌曲封面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> src 歌曲地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into music(name,imgUrl,src) values(#&#123;name&#125;,#&#123;imgUrl&#125;,#&#123;src&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">saveMusic</span><span class="params">(String name,String imgUrl,String src)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取数据库中的歌曲信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from music"</span>)</span><br><span class="line">    <span class="function">List&lt;Music&gt; <span class="title">listMusic</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id随机获取一首歌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id int</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Music</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from music where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function">Music <span class="title">getMusicById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>srerivce:</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.after.demo.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.after.demo.entity.Music;</span><br><span class="line"><span class="keyword">import</span> com.after.demo.mapper.MusicMapper;</span><br><span class="line"><span class="keyword">import</span> com.after.demo.service.MusicService;</span><br><span class="line"><span class="keyword">import</span> com.after.demo.utils.GetString;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheConfig;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> www.xyjz123.xyz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/4/19 21:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@CacheConfig</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MusicServiceImpl</span> <span class="keyword">implements</span> <span class="title">MusicService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MusicMapper musicMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">saveMusic</span><span class="params">(String name, String imgUrl, String src)</span> </span>&#123;</span><br><span class="line">        List&lt;Music&gt; musicList = musicMapper.listMusic();</span><br><span class="line">        <span class="keyword">for</span> (Music music:musicList)&#123;</span><br><span class="line">            <span class="keyword">if</span> (music.getName().equals(name))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> musicMapper.<span class="title">saveMusic</span><span class="params">(name,imgUrl,src)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Cacheable</span>(value = <span class="string">"music"</span>)</span><br><span class="line">    <span class="keyword">public</span> List&lt;Music&gt; listMusic() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> musicMapper.<span class="title">listMusic</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">Music <span class="title">getMusicById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> maxSize = GetString.MAXSIZE;</span><br><span class="line">        <span class="keyword">if</span> (id &lt;= maxSize)&#123;</span><br><span class="line">            <span class="function"><span class="keyword">return</span> musicMapper.<span class="title">getMusicById</span><span class="params">(id)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>utils:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.after.demo.utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 熊义杰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-3-16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetString</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXSIZE = <span class="number">165</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = (<span class="keyword">int</span>)(Math.random() * MAXSIZE);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数据库效果：<br><img src="https://img-blog.csdnimg.cn/20190424212930374.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwNjYzMzU3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>随机获取一首歌：<br><img src="https://img-blog.csdnimg.cn/20190423121126392.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwNjYzMzU3,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</div><div class="post-copyright"><blockquote><p>原文作者: jie</p><p>原文链接: <a href="http://www.xyj123.xyz/java爬取歌曲并存入数据库.html">http://www.xyj123.xyz/java爬取歌曲并存入数据库.html</a></p><p>版权声明: 转载请注明出处(必须保留原文链接http://www.xyj123.xyz)</p></blockquote></div><div class="tags"><a href="/tags/爬取酷狗歌曲/">爬取酷狗歌曲</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/spring+mybatis事务管理详解.html" class="next">spring,mybatis事务管理配置与@Transactional注解使用</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC80Mjk1NC8xOTUwMA=="></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/java爬取歌曲并存入数据库.html">java爬取歌曲并存入数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/spring+mybatis事务管理详解.html">spring,mybatis事务管理配置与@Transactional注解使用</a></li><li class="post-list-item"><a class="post-list-link" href="/ToQiniu.html">springboot上传图片到七牛云并存入数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/javaEE.html">在云服务器上搭建部署javaEE的环境</a></li><li class="post-list-item"><a class="post-list-link" href="/go google.html">无需翻墙上Google</a></li><li class="post-list-item"><a class="post-list-link" href="/oj四题.html">记录菜鸡第一次用杭电oj</a></li><li class="post-list-item"><a class="post-list-link" href="/搭建gitlab.html">在基于ubuntu16的云服务器搭建gitlab服务。</a></li><li class="post-list-item"><a class="post-list-link" href="/mybatis的ACtable插件.html">springboot+mybatis实现自动创建或者更新表</a></li><li class="post-list-item"><a class="post-list-link" href="/项目推到github.html">如何将自己的本地项目推到github（详细版）</a></li><li class="post-list-item"><a class="post-list-link" href="/mybati的pagehelper分页插件详解.html">mybatis的pagehelper分页插件详解</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java爬虫/">java爬虫</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mybatis/">mybatis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/springboot/">springboot</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ubuntu/">ubuntu</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web前端/">web前端</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web后端/">web后端</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分享/">分享</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/博客搭建/">博客搭建</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务搭建/">服务搭建</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/积累经验/">积累经验</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/mysql8/" style="font-size: 15px;">mysql8</a> <a href="/tags/上传图片/" style="font-size: 15px;">上传图片</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/javaEE部署/" style="font-size: 15px;">javaEE部署</a> <a href="/tags/爬取酷狗歌曲/" style="font-size: 15px;">爬取酷狗歌曲</a> <a href="/tags/ACtable/" style="font-size: 15px;">ACtable</a> <a href="/tags/Google助手/" style="font-size: 15px;">Google助手</a> <a href="/tags/mybatis/" style="font-size: 15px;">mybatis</a> <a href="/tags/初解四题/" style="font-size: 15px;">初解四题</a> <a href="/tags/spring事务管理/" style="font-size: 15px;">spring事务管理</a> <a href="/tags/springboot/" style="font-size: 15px;">springboot</a> <a href="/tags/响应式布局/" style="font-size: 15px;">响应式布局</a> <a href="/tags/gitlab/" style="font-size: 15px;">gitlab</a> <a href="/tags/端口冲突/" style="font-size: 15px;">端口冲突</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://blog.csdn.net/qq_40663357" title="Monkey_jie" target="_blank">Monkey_jie</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">jie.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.3"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script><script>(function(d, s) {
  var j, e = d.getElementsByTagName('body')[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.appendChild(j);
})(document, 'script');
</script></body></html>